"use strict";const c=require("node:fs"),i=require("node:path"),require$$0=require("tty"),unreadconfig=require("unreadconfig");function _interopDefaultCompat(t){return t&&typeof t=="object"&&"default"in t?t.default:t}const c__default=_interopDefaultCompat(c),i__default=_interopDefaultCompat(i),require$$0__default=_interopDefaultCompat(require$$0);function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var picocolors={exports:{}};let tty=require$$0__default,isColorSupported=!("NO_COLOR"in process.env||process.argv.includes("--no-color"))&&("FORCE_COLOR"in process.env||process.argv.includes("--color")||process.platform==="win32"||tty.isatty(1)&&process.env.TERM!=="dumb"||"CI"in process.env),formatter=(t,e,r=t)=>n=>{let s=""+n,p=s.indexOf(e,t.length);return~p?t+replaceClose(s,e,r,p)+e:t+s+e},replaceClose=(t,e,r,n)=>{let s=t.substring(0,n)+r,p=t.substring(n+e.length),u=p.indexOf(e);return~u?s+replaceClose(p,e,r,u):s+p},createColors=(t=isColorSupported)=>({isColorSupported:t,reset:t?e=>`\x1B[0m${e}\x1B[0m`:String,bold:t?formatter("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"):String,dim:t?formatter("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"):String,italic:t?formatter("\x1B[3m","\x1B[23m"):String,underline:t?formatter("\x1B[4m","\x1B[24m"):String,inverse:t?formatter("\x1B[7m","\x1B[27m"):String,hidden:t?formatter("\x1B[8m","\x1B[28m"):String,strikethrough:t?formatter("\x1B[9m","\x1B[29m"):String,black:t?formatter("\x1B[30m","\x1B[39m"):String,red:t?formatter("\x1B[31m","\x1B[39m"):String,green:t?formatter("\x1B[32m","\x1B[39m"):String,yellow:t?formatter("\x1B[33m","\x1B[39m"):String,blue:t?formatter("\x1B[34m","\x1B[39m"):String,magenta:t?formatter("\x1B[35m","\x1B[39m"):String,cyan:t?formatter("\x1B[36m","\x1B[39m"):String,white:t?formatter("\x1B[37m","\x1B[39m"):String,gray:t?formatter("\x1B[90m","\x1B[39m"):String,bgBlack:t?formatter("\x1B[40m","\x1B[49m"):String,bgRed:t?formatter("\x1B[41m","\x1B[49m"):String,bgGreen:t?formatter("\x1B[42m","\x1B[49m"):String,bgYellow:t?formatter("\x1B[43m","\x1B[49m"):String,bgBlue:t?formatter("\x1B[44m","\x1B[49m"):String,bgMagenta:t?formatter("\x1B[45m","\x1B[49m"):String,bgCyan:t?formatter("\x1B[46m","\x1B[49m"):String,bgWhite:t?formatter("\x1B[47m","\x1B[49m"):String});picocolors.exports=createColors(),picocolors.exports.createColors=createColors;var picocolorsExports=picocolors.exports;const o=getDefaultExportFromCjs(picocolorsExports),f=["applypatch-msg","pre-applypatch","post-applypatch","pre-commit","pre-merge-commit","prepare-commit-msg","commit-msg","post-commit","pre-rebase","post-checkout","post-merge","pre-push","pre-receive","update","proc-receive","post-receive","post-update","reference-transaction","push-to-checkout","pre-auto-gc","post-rewrite","sendemail-validate","fsmonitor-watchman","p4-changelist","p4-prepare-changelist","p4-post-changelist","p4-pre-submit","post-index-change"],k=["preserveUnused"],defineConfig=t=>t;function g(t=process.cwd()){let e=t;if(typeof e=="string"&&(e[e.length-1]!==i__default.sep&&(e+=i__default.sep),e=i__default.normalize(e),e=e.split(i__default.sep)),!e.length)return;e.pop();let r=e.join(i__default.sep),n=i__default.join(r,".git");if(c__default.existsSync(n)){if(!c__default.lstatSync(n).isDirectory()){let s=c__default.readFileSync(n,{encoding:"utf-8"}),p=/^gitdir: (.*)\s*$/.exec(s);if(p){let u=p[1],a=i__default.join(u,"commondir");return c__default.existsSync(a)?(a=c__default.readFileSync(a,"utf8").trim(),i__default.resolve(u,a)):i__default.normalize(u)}}return i__default.normalize(n)}else return g(e)}function S(t){function e(p,u){return JSON.stringify(p)===JSON.stringify(u)}const r=t.split(/[\\/]/),n=r.indexOf(".pnpm");if(n>-1)return r.slice(0,n-1).join("/");const s=r.indexOf(".store");if(s>-1)return r.slice(0,s-1).join("/");if(!(r.includes(".yarn")&&r.includes("unplugged"))&&r.length>2&&e(r.slice(r.length-2,r.length),["node_modules","git-hooks"]))return r.slice(0,r.length-2).join("/")}function w(t){if(typeof t!="string")throw TypeError("Package json path is not a string!");const{packageJsonContent:e}=m(t);return"dependencies"in e&&"git-hooks"in e.dependencies?(console.log(o.yellow("[WARN] You should move git-hooks to the devDependencies!")),!0):"devDependencies"in e?"git-hooks"in e.devDependencies:!1}function O(t=process.cwd(),e=process.argv){const r=C(e),n=h(t,r);if(!n)throw"[ERROR] Config was not found! Please add `git-hooks.config.ts` or `git-hooks.config.js` entry in package.json.\r\nCheck README for details";const s=Array.isArray(n.preserveUnused)?n.preserveUnused:n.preserveUnused?f:[];for(let p of f)Object.prototype.hasOwnProperty.call(n,p)?D(p,n[p],t):s.includes(p)||d(p,t)}function D(t,e,r=process.cwd()){const n=g(r);if(!n){console.log(o.green("[INFO] No `.git` root folder found, skipping"));return}const s=`#!/bin/sh
`+e,p=n+"/hooks/",u=i__default.normalize(p+t),a=i__default.normalize(p);c__default.existsSync(a)||c__default.mkdirSync(a),c__default.writeFileSync(u,s),c__default.chmodSync(u,493),console.log(o.green(`[INFO] Successfully set the ${t} with command: ${e}`))}function v(t=process.cwd()){for(let e of f)d(e,t)}function d(t,e=process.cwd()){const r=g(e),n=i__default.normalize(r+"/hooks/"+t);c__default.existsSync(n)&&c__default.unlinkSync(n)}function m(t=process.cwd()){if(typeof t!="string")throw TypeError("projectPath is not a string");const e=i__default.normalize(t+"/package.json");if(!c__default.statSync(e).isFile())throw Error("Package.json doesn't exist");const r=c__default.readFileSync(e);return{packageJsonContent:JSON.parse(r),packageJsonPath:e}}function C(t=[]){return t[2]||""}const _="git-hooks";function h(t,e=""){if(typeof t!="string")throw TypeError("Check project root path! Expected a string, but got "+typeof t);const r=[()=>unreadconfig.readConfig(_),()=>x(t)];e&&r.unshift(()=>unreadconfig.readConfig(e));for(let n of r){let s=n();if(s&&y(s))return s;if(s&&!y(s))throw"[ERROR] Config was not in correct format. Please check git hooks or options name"}}function x(t=process.cwd()){const{packageJsonContent:e}=m(t),r=e["git-hooks"];return typeof r=="string"?h(r):e["git-hooks"]}function y(t){for(let e in t)if(!f.includes(e)&&!k.includes(e))return!1;return!0}exports.O=O,exports.S=S,exports.defineConfig=defineConfig,exports.g=g,exports.o=o,exports.v=v,exports.w=w;
